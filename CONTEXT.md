# Copilot Context for File-Based Chat System (FastAPI Backend)

## 🌐 Project Overview

This project is a file-based chat system where authenticated users can upload files, initiate a session, and interact via chat queries. Each session is strictly tied to a fixed set of files and maintains a separate chat history. The backend is built using **FastAPI**.

## 🔐 Authentication

* Mocked login (hardcoded user ID for now)
* Every action is performed in the context of a user (e.g., `user_id = "testuser"`)

## 📂 Sessions

* New session is created when files are uploaded
* Session ID is timestamp-based (e.g., `sess_20250720_1530`)
* Default session name is the timestamp
* Users can rename sessions (future feature)
* One session = one set of files + one chat log
* All session data is stored under `sessions/{user_id}/{session_id}/`

## 📁 Session Folder Structure

```
sessions/
  ├── user123/
      ├── sess_20250720_1530/
          ├── files/            # All uploaded files
          ├── history.json      # List of Q&A
          └── metadata.json     # session_id, name, created_at
```

## 💾 Files

* Users can upload `.txt` and `.db` files
* Upload only allowed *before* session starts
* Files are passed to a simulated backend function (later replaced by real logic)

## 💬 Chat Queries

* Each query is associated with a session
* Response is generated by a mock `process_query()` function
* Output is simulated and saved alongside the query
* History is a list of dicts with `question`, `answer`, and `timestamp`

## 🔍 Session Listing

* Users can view a list of their sessions
* Selecting a session loads its chat history and file list

## 🌐 API Endpoints

```
POST   /login                    # Simulated login
POST   /upload                  # Upload files, start new session
GET    /sessions                # List sessions for user
GET    /session/{id}            # Get session metadata
GET    /session/{id}/files      # List session files
GET    /session/{id}/history    # Get full chat history
POST   /session/{id}/query      # Send query and receive response
```

## 💻 Frontend UI (separate Dash app)

* User logs in
* Left panel: list of sessions
* Right panel: list of files in selected session
* Center: chat interface with history + input

## ✅ Dev Status

We are currently scaffolding the backend. Frontend to follow.

## 🔧 To Do (Backend)

* [ ] Set up FastAPI app (`main.py`)
* [ ] Set up routing (`api/routes.py`)
* [ ] Session manager for file + history control
* [ ] Mock query engine (simulate response)
* [ ] Test each step via Swagger UI
